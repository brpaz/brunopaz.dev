---
import { getCollection } from 'astro:content';
import type { BlogPost } from '~/content/types';
import type { CollectionEntry } from 'astro:content';
import { BlogPostCollection } from '~/content/types';
import DefaultLayout from '~/layouts/Default.astro';
import PageTitle from '~/components/shared/PageTitle.astro';
import FormattedDate from '~/components/blog/FormattedDate.astro';
import TagsList from '~/components/blog/TagsList.astro';
import GiscusComments from '~/components/blog/GiscusComments.astro';
interface Props {
  post: CollectionEntry<BlogPost>;
}

export async function getStaticPaths() {
  const posts = await getCollection(BlogPostCollection);
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { title, publishDate, excerpt } = post.data;
const ogImage = `/open-graph/${post.slug}`;
const { Content } = await post.render();
---

<style is:global>
  .post-content img {
    display: flex;
    margin: 0 auto;
    border-radius: 0.5rem;
    box-shadow:
      0 4px 6px -1px rgb(0 0 0 / 0.1),
      0 2px 4px -2px rgb(0 0 0 / 0.1);
  }
</style>

<DefaultLayout title=`${title} | Bruno Paz` description={excerpt} ogImage={ogImage}>
  <div class="max-w-4xl mx-auto">
    <article class="mb-16">
      <header class="mb-12 text-center">
        <PageTitle title={title} />

        <div class="flex flex-col items-center gap-4 mt-6">
          {
            publishDate && (
              <div class="text-neutral-600 text-sm font-medium">
                <FormattedDate date={publishDate} />
              </div>
            )
          }

          {
            post.data.tags.length > 0 && (
              <div class="flex justify-center">
                <TagsList tags={post.data.tags} />
              </div>
            )
          }
        </div>
      </header>

      <div class="post-content prose prose-lg prose-neutral max-w-none px-4">
        <Content />
      </div>
    </article>

    <GiscusComments />
  </div>
</DefaultLayout>
