---
import type { Page, PaginateFunction } from 'astro';
import type { CollectionEntry } from 'astro:content';
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import DefaultLayout from '~/layouts/Default.astro';
import PageTitle from '~/components/shared/PageTitle.astro';
import Post from '~/components/blog/Post.astro';
import IconWriting from '~/assets/icons/writing.svg';
import type { BlogPost } from '~/content/types';
import { sortPosts } from '~/content/posts';
import { BlogPostCollection } from '~/content/types';
import { Pagination } from '@sarissa/pagination';

export const pageSize = 5;

interface PostsData {
  params: { slug: string };
  props: { post: CollectionEntry<BlogPost> };
}

// Define the function with the specified types
export async function getStaticPaths({ paginate }: { paginate: PaginateFunction }) {
  const postEntries = await getCollection(BlogPostCollection, ({ data }) => {
    return import.meta.env.PROD ? data.published === true : true;
  });

  const posts = sortPosts(postEntries).map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));

  return paginate(posts, { pageSize: pageSize });
}

const { page }: { page: Page<PostsData> } = Astro.props;

const posts = page.data.map((data) => {
  return data.props.post;
});
---

<DefaultLayout>
  <div class="max-w-4xl mx-auto">
    <div class="text-center mb-16">
      <Image
        src={IconWriting}
        height="96"
        width="96"
        class="mx-auto mb-6 opacity-90"
        alt="Blog"
        title="Blog"
        aria-hidden="true"
      />
      <PageTitle title="My Blog" />
      <p class="text-neutral-600 mt-4 text-lg">
        Thoughts, ideas, and learnings from my journey in software development
      </p>
    </div>

    <div class="space-y-12 mb-16">
      {
        posts.map((post) => (
          <div class="group">
            <Post post={post} />
          </div>
        ))
      }
    </div>

    {
      page.total > 1 && (
        <div class="mt-20 mb-12">
          <Pagination
            currentPage={page.currentPage}
            totalPage={page.lastPage}
            url="blog/page"
            buttonGroup="flex items-center justify-center gap-3"
            activeButton="!bg-primary-500 !text-white hover:!bg-primary-600 border-primary-500 current-page"
            outerDiv="flex items-center justify-center"
            button="relative inline-flex items-center px-4 py-2 text-sm font-medium rounded-lg border border-neutral-300 bg-white text-neutral-700 hover:bg-neutral-50 transition-colors duration-200"
          />
        </div>
      )
    }
  </div>
</DefaultLayout>
