---
import { getCollection, type CollectionEntry } from 'astro:content';

import DefaultLayout from '~/layouts/Default.astro';
import PageTitle from '~/components/shared/PageTitle.astro';
import ProjectHeader from '~/components/work/ProjectDetailHeader.astro';
import ProjectTech from '~/components/work/ProjectDetailTech.astro';
import ProjectGallery from '~/components/work/ProjectDetailGallery.astro';

import type { Project } from '~/content/types';
import { ProjectCollection } from '~/content/types';

interface Props {
  project: CollectionEntry<Project>;
}

export async function getStaticPaths() {
  const projects = await getCollection(ProjectCollection);
  return projects.map((project) => ({
    params: { slug: project.slug },
    props: { project },
  }));
}

const { project } = Astro.props;
const { Content } = await project.render();
---

<style is:global>
  @reference '../../assets/styles/global.css';
  .project-detail-content h2 {
    @apply font-bold text-3xl mb-6 mt-8;
  }

  .project-detail-content h3 {
    @apply font-bold text-xl mb-4 mt-6;
  }

  .project-detail-content p {
    @apply mb-6 leading-relaxed text-base;
  }

  .project-detail-content img {
    @apply my-6 mx-auto rounded-lg shadow-md;
  }

  .project-detail-content ul {
    @apply list-disc ml-6 mb-6 space-y-3;
  }

  .project-detail-content ul li {
    @apply leading-relaxed;
  }

  .project-detail-content hr {
    @apply my-12 border-neutral-300;
  }

  .project-detail-content a {
    @apply text-primary-600 hover:text-primary-700 underline;
  }
</style>
<DefaultLayout title={project.data.name} description={project.data.description}>
  <div class="max-w-4xl mx-auto">
    <PageTitle title={project.data.name} />

    <ProjectHeader project={project} />

    {
      project.data.images.length > 0 && (
        <div class="my-12">
          <ProjectGallery slug={project.slug} images={project.data.images} />
        </div>
      )
    }

    <div class="project-detail-content prose prose-lg max-w-none mb-12">
      <Content />
    </div>

    {
      project.data.technologies.length > 0 && (
        <div class="mt-12 pt-8 border-t border-neutral-200">
          <ProjectTech technologies={project.data.technologies} />
        </div>
      )
    }
  </div>
</DefaultLayout>
