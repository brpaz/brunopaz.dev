---
import { Image } from 'astro:assets';
import '@splidejs/splide/css';

interface Props {
  slug: string;
  images: string[];
}

const { slug, images } = Astro.props as Props;

export async function getImages(slug: string, imageNames: string[]): Promise<any[]> {
  return Promise.all(
    imageNames.map(async (image) => {
      const imageParts = image.split('.');
      const imageFileName = imageParts[0];
      const imageFileExtension = imageParts[1];

      return (await import(`../../assets/images/projects/${slug}/${imageFileName}.${imageFileExtension}`)).default;
    }),
  );
}

const imageUrls = await getImages(slug, images);
---

<section id="image-carousel" class="splide mb-6 rounded-lg overflow-hidden shadow-lg" aria-label="Project Images">
  <div class="splide__track">
    <ul class="splide__list">
      {
        imageUrls.map((imageUrl, index) => (
          <li class="splide__slide">
            <Image
              width={1280}
              height={720}
              src={imageUrl}
              alt={`Project Image ${index + 1}`}
              loading="eager"
              class="w-full h-auto"
            />
          </li>
        ))
      }
    </ul>
  </div>
</section>

<section
  id="thumbnail-carousel"
  class={`splide flex justify-center ${imageUrls.length === 1 ? 'hidden' : ''}`}
  aria-label="Project Thumbnail Images"
>
  <div class="splide__track">
    <ul class="splide__list">
      {
        imageUrls.map((imageUrl, index) => (
          <li class="splide__slide">
            <Image
              src={imageUrl}
              width={120}
              height={80}
              alt={`Project Image ${index + 1}`}
              class="rounded cursor-pointer"
            />
          </li>
        ))
      }
    </ul>
  </div>
</section>

<style>
  .splide__slide {
    width: 100%;
    align-items: center;
    display: flex;
  }

  .splide__slide img {
    max-width: 100%;
    max-height: 100%;
    display: flex;
    margin: 0 auto;
  }

  #thumbnail-carousel .splide__slide {
    border: 2px solid transparent;
    border-radius: 0.5rem;
    overflow: hidden;
    transition: all 0.2s;
  }

  #thumbnail-carousel .splide__slide:hover {
    border-color: rgb(59 130 246 / 0.5);
  }

  #thumbnail-carousel .splide__slide.is-active {
    border-color: rgb(59 130 246);
  }

  .splide__arrow {
    background: rgba(255, 255, 255, 0.9);
    width: 3em;
    height: 3em;
  }

  .splide__arrow:hover {
    background: rgb(255, 255, 255);
  }

  .splide__arrow svg {
    fill: rgb(59 130 246);
  }
</style>

<script>
  import { Splide } from '@splidejs/splide';

  let mainCarousel: Splide;
  let thumbsCarousel: Splide;

  function initGallery() {
    // Required for Astro not try to run this code on pages without the carousel.
    const carouselElement = document.getElementById('image-carousel');

    if (!carouselElement) {
      return;
    }

    const imageCount = carouselElement.querySelectorAll('img').length;

    mainCarousel = new Splide('#image-carousel', {
      type: 'fade',
      rewind: true,
      pagination: false,
      arrows: imageCount > 1,
    });

    thumbsCarousel = new Splide('#thumbnail-carousel', {
      fixedWidth: 120,
      fixedHeight: 80,
      gap: 10,
      rewind: true,
      pagination: false,
      isNavigation: true,
      arrows: false,
    });

    thumbsCarousel.mount();
    mainCarousel.sync(thumbsCarousel).mount();
  }
  document.addEventListener('astro:page-load', initGallery);
</script>
