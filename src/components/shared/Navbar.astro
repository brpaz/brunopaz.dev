---
const currentPage = new URL(Astro.request.url).pathname;

const menuItems = [
  {
    title: 'About',
    path: '/about',
    rootPath: '/about',
  },
  {
    title: 'Work',
    path: '/work',
    rootPath: '/work',
  },
  {
    title: 'CV',
    path: '/cv',
    rootPath: '/cv',
  },
  {
    title: 'Blog',
    path: '/blog/page/1',
    rootPath: '/blog',
  },
  {
    title: 'Contact',
    path: '/contact',
    rootPath: '/contact',
  },
];
---

<script is:inline>
  function toggleMobileMenu() {
    const drawer = document.getElementById('mobile-drawer');
    const overlay = document.getElementById('mobile-overlay');
    const body = document.body;

    const isOpen = !drawer.classList.contains('translate-x-full');

    if (isOpen) {
      drawer.classList.add('translate-x-full');
      overlay.classList.add('hidden');
      body.style.overflow = '';
    } else {
      drawer.classList.remove('translate-x-full');
      overlay.classList.remove('hidden');
      body.style.overflow = 'hidden';
    }
  }

  var initMobileMenu = () => {
    const menuButton = document.getElementById('menu-toggle');
    const overlay = document.getElementById('mobile-overlay');
    const closeButton = document.getElementById('drawer-close');

    menuButton?.addEventListener('click', toggleMobileMenu);
    overlay?.addEventListener('click', toggleMobileMenu);
    closeButton?.addEventListener('click', toggleMobileMenu);
  };

  window.addEventListener('DOMContentLoaded', initMobileMenu);
  document.addEventListener('astro:after-swap', initMobileMenu);
</script>

<style>
  @reference "../../assets/styles/global.css";

  .main-nav a {
    @apply relative font-medium text-base text-neutral-600 hover:text-primary-500 transition-colors duration-200;
  }

  .main-nav a::after {
    @apply absolute left-0 bottom-0 w-0 h-0.5 bg-primary-500 transition-all duration-300;
    content: '';
  }

  .main-nav a:hover::after {
    @apply w-full;
  }

  .main-nav a.active {
    @apply text-primary-500;
  }

  .main-nav a.active::after {
    @apply w-full;
  }

  #mobile-drawer a {
    @apply relative font-medium text-lg text-neutral-700 hover:text-primary-500 transition-colors duration-200 py-4 px-6 block;
  }

  #mobile-drawer a.active {
    @apply text-primary-500 border-l-4 border-primary-500 bg-primary-50;
  }

  #mobile-drawer a:hover {
    @apply bg-neutral-50;
  }
</style>

<!-- Desktop Navigation -->
<ul class="main-nav items-center gap-8 hidden md:flex">
  {
    menuItems.map((item) => (
      <li>
        <a href={item.path} class={currentPage.startsWith(item.rootPath) ? 'active' : ''}>
          {item.title}
        </a>
      </li>
    ))
  }
</ul>

<!-- Mobile Menu Toggle -->
<button
  id="menu-toggle"
  aria-expanded="false"
  aria-label="Open navigation menu"
  class="md:hidden inline-flex items-center justify-center p-2 rounded-md text-neutral-600 hover:bg-neutral-100 focus:outline-none focus:ring-2 focus:ring-primary-500 transition-colors duration-200"
  style="width:48px;height:48px"
>
  <span class="sr-only">Open main menu</span>
  <svg
    xmlns="http://www.w3.org/2000/svg"
    fill="none"
    viewBox="0 0 24 24"
    stroke="currentColor"
    aria-hidden="true"
    class="block w-6 h-6"
  >
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
  </svg>
</button>

<!-- Mobile Menu Overlay -->
<div
  id="mobile-overlay"
  class="hidden absolute inset-0 bg-black/50 z-[60] md:hidden"
  aria-hidden="true"
>
</div>

<!-- Mobile Menu Drawer -->
<div
  id="mobile-drawer"
  class="absolute top-0 right-0 h-screen w-64 bg-white shadow-lg transform translate-x-full transition-transform duration-300 z-[70] md:hidden flex flex-col"
>
  <div class="flex items-center justify-between p-4 border-b border-neutral-200">
    <span class="text-lg font-semibold text-neutral-900">Menu</span>
    <button
      id="drawer-close"
      aria-label="Close navigation menu"
      class="inline-flex items-center justify-center p-2 rounded-md text-neutral-600 hover:bg-neutral-100 focus:outline-none focus:ring-2 focus:ring-primary-500 transition-colors duration-200"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        class="w-6 h-6"
      >
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
  </div>
  <nav class="flex-1 overflow-y-auto">
    <ul class="py-2">
      {
        menuItems.map((item) => (
          <li>
            <a href={item.path} class={currentPage.startsWith(item.rootPath) ? 'active' : ''}>
              {item.title}
            </a>
          </li>
        ))
      }
    </ul>
  </nav>
</div>
